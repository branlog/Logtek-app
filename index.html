<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Logtek 2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script defer src="config.js"></script>
  <script defer src="app.js"></script>
</head>
<body>
<header>
  <h1>Logtek 2.0</h1>
  <nav>
    <a href="#" onclick="showView('catalog')">Catalogue</a> |
    <a href="#" onclick="showView('cart')">Panier</a> |
    <a href="#" onclick="showView('checkout')">Commander</a> |
    <a href="#" onclick="showView('admin')">Admin</a>
  </nav>
</header>

<main id="view-catalog" class="view active">
  <h2>Catalogue</h2>
  <div id="catalog"></div>
</main>

<main id="view-cart" class="view">
  <h2>Panier</h2>
  <div id="cart"></div>
</main>

<main id="view-checkout" class="view">
  <h2>Checkout avec GPS</h2>
  <form id="checkoutForm">
    <label>Nom <input name="name" required></label><br>
    <label>T√©l√©phone <input name="phone" required></label><br>
    <label>Adresse <input name="address"></label><br>
    <div id="map" style="height:300px;margin:10px 0;"></div>
    <input type="hidden" name="lat" id="lat">
    <input type="hidden" name="lng" id="lng">
    <button type="button" onclick="useMyLocation()">üìç Utiliser ma position</button><br><br>
    <button type="submit">Confirmer commande</button>
  </form>
</main>

<main id="view-admin" class="view">
  <h2>Admin Dashboard</h2>
  <div id="adminStats"></div>
  <h3>Carte des commandes</h3>
  <div id="adminMap" style="height:400px"></div>
</main>

<script>
let map, marker;
function initMap(){
  map = L.map('map').setView([47.67, -68.48], 9);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  map.on('click', function(e){
    if(marker) marker.remove();
    marker = L.marker(e.latlng).addTo(map);
    document.getElementById('lat').value = e.latlng.lat;
    document.getElementById('lng').value = e.latlng.lng;
  });
}
function useMyLocation(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      const lat = pos.coords.latitude, lng = pos.coords.longitude;
      map.setView([lat,lng], 13);
      if(marker) marker.remove();
      marker = L.marker([lat,lng]).addTo(map);
      document.getElementById('lat').value = lat;
      document.getElementById('lng').value = lng;
    });
  }
}
window.addEventListener('DOMContentLoaded', initMap);
</script>
</body>
</html>
